package com.mercadolibre.vulnscania.domain.model.vulnerability;

import com.mercadolibre.vulnscania.domain.exception.InvalidCveIdException;

import java.time.LocalDate;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * Value Object que representa un CVE ID válido.
 * Formato: CVE-YYYY-NNNNN (ej: CVE-2024-1234)
 */
public record CveId(String value) {
    
    private static final Pattern CVE_PATTERN = Pattern.compile("^CVE-(\\d{4})-(\\d{4,})$");
    
    public CveId {
        if (value == null || value.isBlank()) {
            throw new InvalidCveIdException(value);
        }
        
        Matcher matcher = CVE_PATTERN.matcher(value);
        if (!matcher.matches()) {
            throw new InvalidCveIdException(value);
        }
    }
    
    /**
     * Extrae el año del CVE.
     */
    public int getYear() {
        return Integer.parseInt(value.substring(4, 8));
    }
    
    /**
     * Determina si el CVE es de los últimos 2 años.
     * Regla de negocio: CVEs muy antiguos pueden tener menos relevancia.
     */
    public boolean isRecent() {
        int currentYear = LocalDate.now().getYear();
        return getYear() >= currentYear - 2;
    }
    
    /**
     * Verifica si el CVE es del año especificado.
     */
    public boolean isFromYear(int year) {
        return getYear() == year;
    }
}

