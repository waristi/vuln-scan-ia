package com.mercadolibre.vulnscania.domain.model.vulnerability;

import com.mercadolibre.vulnscania.domain.exception.InvalidScoreException;

/**
 * Value Object que representa un score de severidad CVSS (0.0 - 10.0).
 * Encapsula reglas de negocio sobre niveles de severidad.
 */
public record SeverityScore(double value) {
    
    public static final double MIN_SCORE = 0.0;
    public static final double MAX_SCORE = 10.0;
    public static final double CRITICAL_THRESHOLD = 9.0;
    public static final double HIGH_THRESHOLD = 7.0;
    public static final double MEDIUM_THRESHOLD = 4.0;
    
    public SeverityScore {
        if (value < MIN_SCORE || value > MAX_SCORE) {
            throw new InvalidScoreException(value);
        }
    }
    
    /**
     * Determina si el score es crítico (>= 9.0).
     */
    public boolean isCritical() {
        return value >= CRITICAL_THRESHOLD;
    }
    
    /**
     * Determina si el score es alto (>= 7.0).
     */
    public boolean isHigh() {
        return value >= HIGH_THRESHOLD;
    }
    
    /**
     * Determina si el score es medio (>= 4.0).
     */
    public boolean isMedium() {
        return value >= MEDIUM_THRESHOLD;
    }
    
    /**
     * Determina si requiere acción inmediata (>= 7.0).
     */
    public boolean requiresAction() {
        return value >= HIGH_THRESHOLD;
    }
    
    /**
     * Aumenta el score por un factor, sin exceder el máximo.
     */
    public SeverityScore increase(double factor) {
        if (factor < 1.0) {
            throw new IllegalArgumentException("Factor must be >= 1.0");
        }
        return new SeverityScore(Math.min(MAX_SCORE, value * factor));
    }
    
    /**
     * Reduce el score por una cantidad, sin bajar del mínimo.
     */
    public SeverityScore reduce(double amount) {
        if (amount < 0) {
            throw new IllegalArgumentException("Amount must be positive");
        }
        return new SeverityScore(Math.max(MIN_SCORE, value - amount));
    }
    
    /**
     * Ajusta el score por un delta (puede ser positivo o negativo).
     */
    public SeverityScore adjust(double delta) {
        double newValue = value + delta;
        return new SeverityScore(Math.max(MIN_SCORE, Math.min(MAX_SCORE, newValue)));
    }
}

